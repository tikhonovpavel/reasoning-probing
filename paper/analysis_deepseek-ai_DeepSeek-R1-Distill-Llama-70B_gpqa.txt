/disk/4tb/tikhonov/projects/reasoning-probing/analyze_accuracy_vs_length.py:157: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  plot_df['total_in_bin'] = plot_df.groupby('num_chunks_range')['count'].transform('sum')
/disk/4tb/tikhonov/projects/reasoning-probing/analyze_accuracy_vs_length.py:205: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  y_pos = bottoms[j] + height / 2
2025-09-21 11:30:14,747 - INFO - Binned plot saved to analysis_results/accuracy_vs_length/binned_accuracy_vs_length_by_changes_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png

--- Accuracy vs. Reasoning Chain Length (Raw) ---
 num_chunks  accuracy  count
          1  0.894737     19
          2  0.761905     21
          3  0.777778      9
          4  0.125000      8
          5  0.777778     18
          6  0.769231     13
          7  0.750000      8
          8  0.769231     13
          9  0.750000      4
         10  0.857143      7
         11  0.666667      9
         12  0.777778      9
         13  1.000000      3
         14  0.750000      4
         15  0.750000      4
         16  1.000000      4
         17  0.600000      5
         18  0.571429      7
         19  0.500000      6
         20  0.250000      4
         21  0.333333      3
         22  0.428571      7
         23  0.500000      4
         24  1.000000      2
         25  0.000000      2
         26  0.750000      4
         27  0.666667      3
         28  0.500000      2
         29  0.666667      6
         30  1.000000      2
         31  1.000000      1
         32  1.000000      3
         33  1.000000      2
         34  1.000000      2
         35  0.250000      4
         36  0.500000      2
         37  0.500000      4
         38  0.000000      2
         39  0.500000      2
         41  0.000000      1
         44  0.000000      1
         48  0.000000      1
         54  1.000000      1
         57  0.000000      1
         59  1.000000      1
         61  0.000000      1
         64  1.000000      1
         70  1.000000      1
         71  0.000000      1
         78  1.000000      1
         79  1.000000      1
----------------------------------------

--- Accuracy vs. Reasoning Chain Length (Binned at >8.0%) ---

--- Bin: 1-1 (Total: 19 examples, 7.8%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.89     19             100.00                 7.79
1                         0.00      0               0.00                 0.00
2                         0.00      0               0.00                 0.00
3+                        0.00      0               0.00                 0.00

--- Bin: 2-2 (Total: 21 examples, 8.6%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.74     19              90.48                 7.79
1                         1.00      2               9.52                 0.82
2                         0.00      0               0.00                 0.00
3+                        0.00      0               0.00                 0.00

--- Bin: 3-5 (Total: 35 examples, 14.3%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.68     25              71.43                10.25
1                         0.50     10              28.57                 4.10
2                         0.00      0               0.00                 0.00
3+                        0.00      0               0.00                 0.00

--- Bin: 6-7 (Total: 21 examples, 8.6%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.69     13              61.90                 5.33
1                         0.88      8              38.10                 3.28
2                         0.00      0               0.00                 0.00
3+                        0.00      0               0.00                 0.00

--- Bin: 8-10 (Total: 24 examples, 9.8%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.80     10              41.67                 4.10
1                         0.90     10              41.67                 4.10
2                         0.50      4              16.67                 1.64
3+                        0.00      0               0.00                 0.00

--- Bin: 11-13 (Total: 21 examples, 8.6%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.70     10              47.62                 4.10
1                         1.00      7              33.33                 2.87
2                         0.33      3              14.29                 1.23
3+                        1.00      1               4.76                 0.41

--- Bin: 14-18 (Total: 24 examples, 9.8%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.80     10              41.67                 4.10
1                         0.67      6              25.00                 2.46
2                         0.50      4              16.67                 1.64
3+                        0.75      4              16.67                 1.64

--- Bin: 19-22 (Total: 20 examples, 8.2%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.20      5              25.00                 2.05
1                         0.20      5              25.00                 2.05
2                         0.67      3              15.00                 1.23
3+                        0.57      7              35.00                 2.87

--- Bin: 23-29 (Total: 23 examples, 9.4%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.57      7              30.43                 2.87
1                         0.67      6              26.09                 2.46
2                         0.50      4              17.39                 1.64
3+                        0.67      6              26.09                 2.46

--- Bin: 30-37 (Total: 20 examples, 8.2%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         1.00      4              20.00                 1.64
1                         0.71      7              35.00                 2.87
2                         0.50      2              10.00                 0.82
3+                        0.57      7              35.00                 2.87

--- Bin: 38-79 (Total: 16 examples, 6.6%) ---
                      accuracy  count  percentage_of_bin  percentage_of_total
num_changes_category                                                         
0                         0.50      8              50.00                 3.28
1                         0.50      2              12.50                 0.82
2                         0.00      1               6.25                 0.41
3+                        0.40      5              31.25                 2.05
------------------------------------------------------------
========================================
2025-09-21 11:30:16,550 - INFO - Scatter plot saved to analysis_results/critical_chunk_prob_change/prob_change_scatter_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
2025-09-21 11:30:16,929 - INFO - Histogram saved to analysis_results/critical_chunk_prob_change/prob_change_hist_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
2025-09-21 11:30:17,071 - INFO - Absolute index histogram saved to analysis_results/critical_chunk_prob_change/critical_index_abs_hist_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
2025-09-21 11:30:17,279 - INFO - Relative index histogram saved to analysis_results/critical_chunk_prob_change/critical_index_rel_hist_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
2025-09-21 11:30:17,778 - INFO - Probability change vs. index plot saved to analysis_results/critical_chunk_prob_change/prob_change_vs_index_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
2025-09-21 11:30:18,031 - INFO - Chunks remaining histogram saved to analysis_results/critical_chunk_prob_change/chunks_remaining_hist_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png

--- Analysis of Probability Change for CORRECT Answer (num_changes = 1) ---
                               count      mean      std       min       25%       50%       75%       max
switch_type                                                                                              
Switch FROM Correct             10.0 -0.359651  0.16686 -0.651778 -0.478250 -0.325264 -0.288185 -0.093099
Switch Incorrect to Incorrect    8.0 -0.010233  0.07460 -0.100549 -0.037790 -0.019833 -0.012071  0.158180
Switch TO Correct               45.0  0.555302  0.24775  0.028711  0.400555  0.621091  0.747038  0.970104
----------------------------------------------------------------------

--- Distribution of Critical Chunk Index (Absolute) ---
count    63.000000
mean      8.968254
std      10.714729
min       1.000000
25%       2.000000
50%       5.000000
75%      11.500000
max      53.000000

--- Distribution of Critical Chunk Index (Relative) ---
count    63.000000
mean      0.495833
std       0.263702
min       0.083333
25%       0.299107
50%       0.475410
75%       0.685185
max       0.981481
----------------------------------------------------------------------

--- Distribution of Chunks Remaining After Critical Switch ---
                               count      mean        std  min   25%  50%    75%   max
switch_type                                                                           
Switch FROM Correct             10.0  4.800000   6.051630  0.0  1.00  2.0   8.75  16.0
Switch Incorrect to Incorrect    8.0  7.750000  10.498299  1.0  1.75  2.0  10.25  31.0
Switch TO Correct               45.0  5.422222   6.020755  0.0  2.00  4.0   7.00  31.0
----------------------------------------------------------------------
========================================
2025-09-21 11:30:22,980 - INFO - Loading tokenizer for model: deepseek-ai/DeepSeek-R1-Distill-Llama-70B
2025-09-21 11:30:24,502 - INFO - Threshold=0.10 | Coverage=69.39% (170/245) | Precision=64.71% (110/170) | Overall Acc=69.80% | Avg Chunk Savings=11.28 (Overall: 7.83) | Avg Token Savings=1342.08 (Overall: 931.24)
2025-09-21 11:30:24,711 - INFO - Threshold=0.20 | Coverage=55.51% (136/245) | Precision=85.29% (116/136) | Overall Acc=80.00% | Avg Chunk Savings=7.15 (Overall: 3.97) | Avg Token Savings=813.65 (Overall: 451.66)
2025-09-21 11:30:24,856 - INFO - Threshold=0.30 | Coverage=42.45% (104/245) | Precision=93.27% (97/104) | Overall Acc=78.37% | Avg Chunk Savings=6.31 (Overall: 2.68) | Avg Token Savings=719.89 (Overall: 305.59)
2025-09-21 11:30:24,955 - INFO - Threshold=0.40 | Coverage=33.06% (81/245) | Precision=98.77% (80/81) | Overall Acc=78.78% | Avg Chunk Savings=5.40 (Overall: 1.78) | Avg Token Savings=603.11 (Overall: 199.40)
2025-09-21 11:30:25,032 - INFO - Threshold=0.50 | Coverage=23.67% (58/245) | Precision=98.28% (57/58) | Overall Acc=74.69% | Avg Chunk Savings=5.86 (Overall: 1.39) | Avg Token Savings=665.72 (Overall: 157.60)
2025-09-21 11:30:25,079 - INFO - Threshold=0.60 | Coverage=17.14% (42/245) | Precision=97.62% (41/42) | Overall Acc=72.24% | Avg Chunk Savings=4.69 (Overall: 0.80) | Avg Token Savings=517.76 (Overall: 88.76)
2025-09-21 11:30:25,118 - INFO - Threshold=0.70 | Coverage=11.43% (28/245) | Precision=96.43% (27/28) | Overall Acc=69.80% | Avg Chunk Savings=5.89 (Overall: 0.67) | Avg Token Savings=621.86 (Overall: 71.07)
2025-09-21 11:30:25,140 - INFO - Threshold=0.80 | Coverage=6.12% (15/245) | Precision=100.00% (15/15) | Overall Acc=69.39% | Avg Chunk Savings=6.13 (Overall: 0.38) | Avg Token Savings=595.00 (Overall: 36.43)
2025-09-21 11:30:25,150 - INFO - Threshold=0.90 | Coverage=2.04% (5/245) | Precision=100.00% (5/5) | Overall Acc=68.16% | Avg Chunk Savings=2.20 (Overall: 0.04) | Avg Token Savings=314.20 (Overall: 6.41)
2025-09-21 11:30:25,151 - INFO - --- Best Heuristic Performance ---
2025-09-21 11:30:25,151 - INFO - Max Overall Accuracy: 80.00% achieved at Threshold=0.20
2025-09-21 11:30:25,151 - INFO -   - Coverage: 55.51% (136/245)
2025-09-21 11:30:25,151 - INFO -   - Precision: 85.29% (116/136)
2025-09-21 11:30:25,151 - INFO -   - Avg Chunk Savings (per trigger): 7.15
2025-09-21 11:30:25,151 - INFO -   - Overall Avg Chunk Savings: 3.97
2025-09-21 11:30:25,151 - INFO -   - Avg Token Savings (per trigger): 813.65
2025-09-21 11:30:25,151 - INFO -   - Overall Avg Token Savings: 451.66
2025-09-21 11:30:25,151 - INFO - ------------------------------------
2025-09-21 11:30:25,913 - INFO - Trade-off plot saved to analysis_results/jump_heuristic/jump_heuristic_tradeoff_reasoning_traces_gpqa_deepseek-ai_DeepSeek-R1-Distill-Llama-70B.png
